ObjetoAdmin=function(){this.Iniciar=function(){console.log("Admin.Iniciar");$Base.Cargando("FALSE");$Base.CargarCSS("devildrey33.admin.min.css",true);$("body").attr({"administrador33":true});$('#BarraPrincipal_Boton33_Estado').off("click").on("click",function(e){$Base.ClickMenu(8);});$('#CH_Logs').off("click").on("click",function(e){console.log("a");$Base.CargarURL('/Web/Log');$Base.ClickMenu(0);});$('#CH_Stats').off("click").on("click",function(e){$Base.CargarURL('/Web/Stats');$Base.ClickMenu(0);});$('#CH_PhpInfo').off("click").on("click",function(e){$Base.CargarURL('/Web/phpinfo');$Base.ClickMenu(0);});$('#CH_GenCacheBuscador').off("click").on("click",function(e){$Base.cmd('GenerarCacheBuscador');});$('#CH_Minificar').off("click").on("click",function(e){$Base.cmd('Minificar-JS-CSS');});$('#CH_IPSBan').click(function(e){$Base.cmd("LimpiarBaneados");});$('#BarraPrincipal_Marco33 .CheckBox').off("click").on("click",function(e){var Marcado=($(this).attr('marcado')==='true')?true:false;$(this).attr({'marcado':!Marcado});switch($(this).attr('id')){case'CH_Admin':$Admin.Desloguear();break;case'CH_HTML':$Base.cmd((Marcado)?'DesactivarMinificarHTML':'ActivarMinificarHTML');break;case'CH_CSS':$Base.cmd((Marcado)?'DesactivarMinificarCSS':'ActivarMinificarCSS');break;case'CH_JS':$Base.cmd((Marcado)?'DesactivarMinificarJS':'ActivarMinificarJS');break;case'CH_DebugPHP':$Base.cmd((Marcado)?'DesactivarDebugPHP':'ActivarDebugPHP');break;case'CH_BorrarPHP':$Base.cmd((Marcado)?'DesactivarBorrarLogPHP':'ActivarBorrarLogPHP');break;break;case'CH_CompresionGZip':$Base.cmd((Marcado)?'DesactivarCompresionGZip':'ActivarCompresionGZip');break;case'CH_CacheImagenes':$Base.cmd((Marcado)?'DesactivarCacheImagenes':'ActivarCacheImagenes');break;case'CH_Mantenimiento':$Base.cmd((Marcado)?'DesactivarMantenimiento':'ActivarMantenimiento');break;case'CH_CheckSpelling':$Base.cmd((Marcado)?'DesactivarCheckSpelling':'ActivarCheckSpelling');break;case'CH_Cors':$Base.cmd((Marcado)?'DesactivarCors':'ActivarCors');break;case'CH_Consola':$Base.cmd((Marcado)?'DesactivarConsola':'ActivarConsola');$Base.Debug((Marcado)?false:true);break;case'CH_PausarBanner':$Base.cmd((Marcado)?'DesactivarPausarBanner':'ActivarPausarBanner');$Banner.OpcionesCanvas.Pausar=(Marcado)?false:true;break;case'CH_MostrarFPS':$Base.cmd((Marcado)?'DesactivarFPSBanner':'ActivarFPSBanner');$Banner.OpcionesCanvas.MostrarFPS=!Marcado;document.getElementById("Cabecera_Stats").style.display=(!Marcado)?"block":"none";break;}});$("#BarraNavegacion_LabGuardar").off("click").on("click",function(){$Admin.Lab_Guardar();});$("#BarraNavegacion_LabGuardarCache").off("click").on("click",function(){$Admin.Lab.Explorar_GenerarCache();});$("#BarraNavegacion .Lab_Explorador_Check").off("click").on("click",function(){$Admin.Lab.Explorar_ClickCheck($(this));});$Lab.Modificado=function(){console.log("Lab.Modificado (ver Admin)",$("body").attr("tipo"),$("body").attr("modificado"),$("body").attr("administrador33"));if($("body").attr("tipo")==="Lab"&&$("body").attr("modificado")==="true"&&$("body").attr("administrador33")!=="undefined"){if($Lab.Guardando===false){if(confirm("No has guardado el archivo, deseas guardarlo antes de continuar?")===true){$Admin.Lab.Guardar();return true;}
else{return false;}}
else{return true;}}};$Base.ResetearTimerTiempoSesion=function(){if($Base.TimerTiempoSesion!==0){clearTimeout($Base.TimerTiempoSesion);}
$Base.TimerTiempoSesion=setTimeout(function(){$Admin.Desloguear();},30*60*1000);};$Base.ResetearTimerTiempoSesion();document.getElementById('devildrey33_Password').setAttribute('type','text');};this.Desloguear=function(){console.log("Admin.Desloguear");$Base.Cargando("TRUE");nAjax=$.post($Base.Raiz+"cmd/Desloguear.cmd");nAjax.done(function(data){Datos=JSON.parse(data);console.log("Admin.Desloguear");$("#BarraNavegacion_Explorador").html(Datos["HTML"]);$Lab.EnlazarEventosExplorador();$Base.Cargando("FALSE");$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}
$('body').attr({'administrador33':false});$Base.ResetearTimerTiempoSesion=function(){};if($Base.TimerTiempoSesion!==0){clearTimeout($Base.TimerTiempoSesion);}
$Base.TimerTiempoSesion=0;});nAjax.fail(function(jqXHR,textStatus,tError){console.log("Admin.Desloguear EscanearEjemplos Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false);$('body').attr({'administrador33':false});});$Base.ClickMenu(0);setTimeout(function(){$('#Marco33').html('');},500);};};var $Admin=new ObjetoAdmin;$(window).on("load",function(){$Admin.Iniciar();});window.onbeforeunload=function(){console.log("window.onbeforeunload",$("body").attr("tipo"),$("body").attr("modificado"),$("body").attr("administrador33"));if(typeof $Admin!=="undefined"){if($("body").attr("tipo")==="Lab"&&$("body").attr("modificado")==="true"&&$("body").attr("administrador33")==="undefined"){return"Atención no has guardado el documento!!";}}};
$Admin.Lab=new function(){this.Guardar=function(){$Lab.Guardando=true;var Archivo=$("#MarcoNavegacionLab").attr("pagina");Codigo=$Lab.Editor.getValue();if($("body").attr("modificado")==="false"){$Base.MostrarMensaje("No se ha modificado el archivo");return;}
$Base.Cargando("TRUE");$Lab.Original=Codigo;$.post($Base.Raiz+"cmd/LabGuardarEjemplo.cmd",{"Archivo":Archivo,"Codigo":Codigo}).done(function(data){Datos=JSON.parse(data);if(Datos["Estado"]===1){console.log("Admin.Lab_Guardar Ajax Error! no es admin");$("#BarraNavegacion_Explorador").html(Datos["HTML"]);$Lab.EnlazarEventosExplorador();$('body').attr({'administrador33':false});$Base.ClickMenu(0);setTimeout(function(){$('#Marco33').html('');},500);$Base.MostrarLogin($Admin.Lab_Guardar);}
else{console.log("Admin.Lab_Guardar Ajax "+Datos["Mensaje"]);$Base.MostrarMensaje(Datos["Mensaje"]);$("body").attr({"modificado":"false"});$Lab.Guardando=false;}
$Base.Cargando("FALSE");$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Admin.Lab_Guardar Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false);$Lab.Guardando=false;});};this.Explorar_ClickCheck=function(Objeto){console.log("Admin.LabExplorar_ClickCheck",Objeto);var Hijos=Objeto.next().next();var Check=Objeto.is(':checked');if(Check){Hijos.find("input[type=checkbox]").each(function(){this.checked=true;});}
else{Hijos.find("input[type=checkbox]").each(function(){this.checked=false;});}
var Modificado=false;$("#BarraNavegacion_LabMarcoExplorador").find("input[type=checkbox]").each(function(){if((this.checked===true&&$(this).attr('def')=='1')||(this.checked===false&&$(this).attr('def')=='0')){Modificado=true;}});if(Modificado==false){$("body").removeAttr("cachemodificada");}
else{$("body").attr({"cachemodificada":true});}};this.Explorar_GenerarCache=function(){$Base.Cargando("TRUE");var Lista=[];$("#BarraNavegacion_LabMarcoExplorador").find("input[type=checkbox]").each(function(){if(this.checked===true){Objeto=$(this).next();Lista.push(Objeto.attr("path"));}});if(Lista.length===0){$Base.MostrarMensaje("No se han seleccionado archivos ni directorios!");return;}
console.log("Admin.LabExplorar_GenerarCache",Lista);JLista=JSON.stringify(Lista);nAjax=$.post($Base.Raiz+"cmd/Lab_GenerarCache.cmd",{"Lista":JLista});nAjax.done(function(data){Datos=JSON.parse(data);console.log("Lab_GenerarCache Completo!");$Base.MostrarMensaje("Cache del laboratorio generada!");$Base.Cargando("FALSE");$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}});nAjax.fail(function(jqXHR,textStatus,tError){console.log("Admin.LabExplorar_GenerarCache Error ajax",jqXHR,textStatus,tError);$Base.MostrarErrorAjax(jqXHR.status,false);});$("#BarraNavegacion_LabMarcoExplorador").find("input[type=checkbox]").each(function(){if(this.checked===true){$(this).attr({'def':'1'});}
else{$(this).attr({'def':'0'});}});$("body").removeAttr("cachemodificada");};};
$Admin.Comentarios=new function(){this.VerEmail=function(Boton){Pagina=$(".Blog").attr("pagina");NumC=$(Boton).parent().parent().attr("comentario");console.log("Admin.Comentarios.VerEmail",Pagina,NumC);nAjax=$.post($Base.Raiz+"cmd/VerEmailComentario.cmd",{"Pagina":Pagina,"NumComentario":NumC}).done(function(data){Datos=JSON.parse(data);$Base.MostrarMensaje(Datos["HTML"]);$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Admin.Comentarios.VerEmail Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error de la petición Ajax al ver el email.");$Base.Cargando("FALSE");});}
this.BotonEliminarComentario=function(Boton){Pagina=$(".Blog").attr("pagina");NumC=$(Boton).parent().parent().attr("comentario");console.log("Admin.BotonEliminarComentario",Pagina,NumC);$Base.Cargando("TRUE");nAjax=$.post($Base.Raiz+"cmd/EliminarComentario.cmd",{"Pagina":Pagina,"NumComentario":NumC}).done(function(data){Datos=JSON.parse(data);if(Datos.Mensaje==="Comentario Eliminado"){$("#Comentarios_Datos > div[comentario="+Datos.NumComentario+"]").remove();}
else{$Base.MostrarMensaje(data.Mensaje);}
$Base.Cargando("FALSE");$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Admin.Comentarios.BotonEliminarComentario Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error de la petición Ajax al eliminar el mensaje.");$Base.Cargando("FALSE");});};this.Edicion=0;this.ComentarioOriginal="";this.BotonEditarComentario=function(Boton){this.Edicion_Cancelar();Comentario=$(Boton).parent().parent();NumC=Comentario.attr("comentario");console.log("Admin.Comentarios.BotonEditarComentario",NumC);Comentario.html(Comentario.html()+"<div>"+"<button onclick='$Admin.Comentarios.Edicion_Guardar()'>Guardar</button>"+"<button onclick='$Admin.Comentarios.Edicion_Cancelar()'>Cancelar</button>"+"</div>");Editor=Comentario.find("div:nth-child(3)");Editor.attr({"contenteditable":true});this.ComentarioOriginal=Editor.html();this.Edicion=Comentario;Editor.focus();};this.Edicion_Guardar=function(){if(this.Edicion!==0){console.log("Admin.Comentarios.Edicion_Guardar",this.Edicion.attr("comentario"));$Base.Cargando("TRUE");var Msg=this.Edicion.find("div:nth-child(3)").html();Msg.replace(' contenteditable="true"','');nAjax=$.post($Base.Raiz+"cmd/EditarComentario.cmd",{"Pagina":$(".Blog").attr("pagina"),"NumComentario":NumC,"Mensaje":Msg}).done(function(data){Datos=JSON.parse(data);if(Datos.Mensaje==="Comentario Editado"){$("#Comentarios_Datos > div[comentario] > div[contenteditable=true]").removeAttr("contenteditable");$Admin.Comentarios.Edicion.find("div:nth-child(4)").remove();$Admin.Comentarios.ComentarioOriginal="";$Admin.Comentarios.Edicion=0;$Comentarios.EnlazarBotonesMensajes();$Base.MostrarMensaje("Mensaje editado");}
else{$Base.MostrarMensaje(data.Mensaje);}
$Base.Cargando("FALSE");$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}}).fail(function(jqXHR,textStatus,tError){console.log("Admin.Comentarios.Edicion_Guardar Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error de la petición Ajax al guardar el mensaje.");$Base.Cargando("FALSE");});this.Edicion.find("div:nth-child(3)").html(Msg);}};this.Edicion_Cancelar=function(){if(this.Edicion!==0){console.log("Admin.Comentarios_Edicion_Cancelar",this.Edicion.attr("comentario"));$("#Comentarios_Datos > div[comentario] > div[contenteditable=true]").removeAttr("contenteditable");this.Edicion.find("div:nth-child(3)").html(this.ComentarioOriginal);this.Edicion.find("div:nth-child(4)").remove();this.ComentarioOriginal="";this.Edicion=0;$Comentarios.EnlazarBotonesMensajes();}};};
$Admin.EditarEntradas=new function(){this.OrigFecha="";this.OrigTitulo="";this.OrigURL="";this.OrigTags="";this.OrigImagen="";this.OrigTipo="";this.Iniciar=function(){console.log("Admin.EditarEntradasIniciar");$("#Editor_BotonAgregar").off("click").on("click",function(){$Admin.EditarEntradas.NuevaEntrada();});$("#Editor_Guardar").off("click").on("click",function(){$Admin.EditarEntradas.Guardar();});$("#Editor_Cancelar").off("click").on("click",function(){$("#devildrey33_Entradas tr[seleccionado]").removeAttr("seleccionado");$("#Editor_Blog").attr({"mostrar":false});});$("#devildrey33_Entradas > tbody > tr").off("click").on("click",function(){$Admin.EditarEntradas.EditarEntrada(this);});};this.NuevaEntrada=function(){$("#Editor_Blog").attr({"mostrar":true});$("#Editor_Guardar").html("Guardar");Fecha=new Date().toDateInputValue();$("#Entrada_Fecha").val(Fecha);console.log("Admin.EditarEntradas.Iniciar",Fecha);this.OrigFecha=Fecha;this.OrigTitulo="";this.OrigURL="";this.OrigTags="";this.OrigImagen="";this.OrigTipo="";};this.EditarEntrada=function(Entrada){console.log("Admin.EditarEntradas.EditarEntrada",Entrada);$("#devildrey33_Entradas tr[seleccionado]").removeAttr("seleccionado");$(Entrada).attr({"seleccionado":true});$("#Editor_Blog").attr({"mostrar":true});$("#Editor_Guardar").html("Editar");Fecha=$(Entrada).find("td:nth-child(1)").html();this.OrigFecha=Fecha.substr(6,4)+"-"+Fecha.substr(3,2)+"-"+Fecha.substr(0,2);this.OrigTitulo=$(Entrada).find("td:nth-child(2)").html();this.OrigURL=$(Entrada).find("td:nth-child(3)").html();this.OrigTags=$(Entrada).find("td:nth-child(4)").html();this.OrigImagen=$(Entrada).find("td:nth-child(5)").html();this.OrigTipo=$(Entrada).find("td:nth-child(6)").html();$("#Entrada_Fecha").val(this.OrigFecha);$("#Entrada_Titulo").val(this.OrigTitulo);$("#Entrada_URL").val(this.OrigURL);$("#Entrada_Imagen").val(this.OrigImagen);$("#Entrada_Tipo").val(this.OrigTipo);Tags=this.OrigTags.split(", ");$("#Editor_Blog > ul > li > input").each(function(){this.checked=false;});for(i=0;i<Tags.length;i++){$Admin.MarcarCheckTag(Tags[i]);}};this.MarcarCheckTag=function(Tag){console.log("Admin.EditarEntradas.MarcarCheckTag",Tag);$("#Editor_Blog > ul > li > span").each(function(){if($(this).html()===Tag){$(this).prev()[0].checked=true;return;}});};this.Guardar=function(){console.log("Admin.EditarEntradas.Guardar",Fecha);if($("#Editor_Guardar").html()==="Guardar"){}
else{}};};
$Admin.Log=new function(){this.IpAdmin="0.0.0.0";this.ArchivoChange=function(){var Combo=document.getElementById("Log_ArchivoActual");this.CargarArchivo(Combo.options[Combo.selectedIndex].innerHTML);};this.CargarArchivo=function(Archivo){$Base.Cargando("TRUE");$("#Log_Lista").html("").css({display:"none"});$("#Log_Stats").html("");$("#MarcoNavegacion").css({cursor:'progress'});$("#Log_Cargando").attr("visible",true);$("#Log_CargandoF1").css({color:"#fff"});nAjax=$.post($Base.Raiz+"cmd/ObtenerLog.cmd",{"Archivo":Archivo}).done(function(data){Datos=JSON.parse(data);document.getElementById("Log_Datos").value=Datos["DatosLog"];$("#ErroresPHP_Info").html(Datos["ErroresPHP"]);if(Datos["ErroresPHP"]!==""){$Base.MostrarErroresPHP();}
$("#Log_CargandoF1").css({color:"#999"});$("#Log_CargandoF2").css({color:"#FFF"});setTimeout(function(){$Admin.Log.Actualizar()},500);}).fail(function(jqXHR,textStatus,tError){console.log("Admin.Log.CargarArchivos Error ajax",jqXHR,textStatus,tError);$Base.MostrarMensaje("Error al cargar el archivo de log...");$Base.Cargando("FALSE");});};this.Actualizar=function(){var Texto=document.getElementById("Log_Datos").value;this.Lineas=Texto.split("\n");this.Ips=[];this.TotalTipos={"Ataques":0,"Advertencias":0,"Errores404":0,"Zips":0,"Documentos":0,"CSS":0,"JS":0,"Imagenes":0,"Otros":0};for(var i=0;i<this.Lineas.length;i++){this.AgregarLinea(this.Lineas[i],i);}
$("#LabelAtaques span").html("Ataques ("+this.TotalTipos["Ataques"]+")");$("#LabelAdvertencias span").html("Advertencias ("+this.TotalTipos["Advertencias"]+")");$("#LabelErrores404 span").html("Errores 404 ("+this.TotalTipos["Errores404"]+")");$("#LabelZips span").html("Zips ("+this.TotalTipos["Zips"]+")");$("#LabelErrores404 span").html("Errores 404 ("+this.TotalTipos["Errores404"]+")");$("#LabelDocumentos span").html("Documentos ("+this.TotalTipos["Documentos"]+")");$("#LabelCSS span").html("CSS ("+this.TotalTipos["CSS"]+")");$("#LabelJS span").html("JavaScript ("+this.TotalTipos["JS"]+")");$("#LabelImagenes span").html("Imagenes ("+this.TotalTipos["Imagenes"]+")");$("#LabelOtros span").html("Otros ("+this.TotalTipos["Otros"]+")");var TotalNavegadores=0;var TotalBots=0;var TotalDesconocido=0;var Checks=this.ObtenerChecks();if(this.Ips.length>0){for(var i=0;i<this.Ips.length;i++){var Info=this.ObtenerNavegador2(this.Ips[i]["Ua"][0]);this.Ips[i]["Info"]=Info;switch(Info["Tipo"]){case 0:TotalNavegadores++;break;case 1:TotalBots++;break;case 2:TotalDesconocido++;break;}
var Destacados=[];for(var e=0;e<this.Ips[i]["Datos"].length;e++){Destacados.push(this.Ips[i]["Datos"][e]);}
if(Destacados.length>0){Destacados.sort(function(a,b){return(b["Relevancia"]-a["Relevancia"]);});this.Ips[i]["Destacados"]=Destacados;}}}
$("#LabelNavegadores span").html("Navegadores ("+TotalNavegadores+")");$("#LabelBots span").html("Bots ("+TotalBots+")");$("#LabelDesconocido span").html("Desconocido ("+TotalDesconocido+")");$("#Log_CargandoF2").css({color:"#999"});$("#Log_CargandoF3").css({color:"#FFF"});setTimeout(function(){$Admin.Log.CrearStats();},500);};this.ParsearRespuesta=function(Respuesta){R=Respuesta.split(" ");Str="";switch(R[0]){case"200":Str="<span class='Log_Entrada_Documento'>Ok</span>";break;case"301":Str="<span class='Log_Entrada_Advertencia'>Moved Permanently</span>";break;case"302":Str="<span class='Log_Entrada_Documento'>Found</span>";break;case"304":Str="<span class='Log_Entrada_Documento'>Not Modified</span>";break;case"403":Str="<span class='Log_Entrada_Ataque'>Forbidden</span>";break;case"404":Str="<span class='Log_Entrada_Error'>Not Found</span>";break;}
return Str;};this.ColorRelevancia=function(Relevancia,Ret=0){if(Ret===404)return"purple";switch(Relevancia){case 9:return"Log_Entrada_Ataque";break;case 8:return"Log_Entrada_Advertencia";break;case 7:return"Log_Entrada_Error";break;case 6:return"Log_Entrada_Zip";break;case 5:return"Log_Entrada_Documento";break;case 4:return"Log_Entrada_CSS";break;case 3:return"Log_Entrada_JS";break;case 2:return"Log_Entrada_Imagen";break;case 1:return"Log_Entrada_Otros";break;}
return"black";};this.ObtenerChecks=function(){return{9:document.getElementById('ChAtaques').checked,8:document.getElementById('ChAdvertencias').checked,7:document.getElementById('ChErrores404').checked,6:document.getElementById('ChZip').checked,5:document.getElementById('ChDocumentos').checked,4:document.getElementById('ChCSS').checked,3:document.getElementById('ChJS').checked,2:document.getElementById('ChImagenes').checked,1:document.getElementById('ChOtros').checked};};this.CrearTablaDatos=function(){var Pagina=-1;var Filas="";var Fecha="";var Checks=this.ObtenerChecks();var Botones="<div class='Log_ListaBotones'>";for(var i=0;i<this.Ips.length;i++){if(this.Ips[i]["Destacados"].length>0){if(Fecha!==this.Ips[i]["Fecha"]){Fecha=this.Ips[i]["Fecha"];Filas+="</div><div class='Log_Lista' id='Log_ListaP"+(++Pagina)+"'"+((Pagina===0)?" style='display:block'":"")+">";Botones+="<input class='Log_ListaBoton' id='Log_ListaBotonaa"+Pagina+"' type='radio' name='Log_ListaBoton'"+((Pagina===0)?" checked='checked'":"")+">"+"<label for='Log_ListaBoton"+Pagina+"'>"+Fecha+"</label>";}
var ColorNavegador="black";var ColorPeticiones=" style='color:#444'";switch(this.Ips[i]["Info"]["Tipo"]){case 0:ColorNavegador='Log_Cliente_Navegador';break;case 1:ColorNavegador='Log_Cliente_Bot';break;case 2:ColorNavegador='Log_Cliente_Desconocido';break;}
if(this.Ips[i]["Datos"].length>200){ColorPeticiones=" style='color:orange'";}
if(this.Ips[i]["Datos"].length>500){ColorPeticiones=" style='color:red'";}
var Ataque="";if(this.Ips[i]["Destacados"][0]["Relevancia"]===9){Ataque=" ataque='true'";}
if(this.IpAdmin===this.Ips[i]["Ip"]){Ataque=" ataque='admin'";}
var Destacados=-1;for(var e=0;e<this.Ips[i]["Destacados"].length;e++){if(Checks[this.Ips[i]["Destacados"][e]["Relevancia"]]===true){Destacados=e;break;}}
var ColorUrl=(Destacados>-1)?this.ColorRelevancia(this.Ips[i]["Destacados"][Destacados]["Relevancia"]):"Log_Entrada_Otros";Filas+="<div class='EntradaLog' id='EntradaLog"+i+"' style='display:"+((Destacados>-1)?"table":'none')+"'>"+"<div class='EntradaLog_TablaFila'"+Ataque+">"+"<div class='EntradaLog_Fila' tipo='"+this.Ips[i]["Info"]["Tipo"]+"'>"+"<div class='EntradaLog_Ip'>"+this.Ips[i]["Ip"]+"</div>"+"<div class='EntradaLog_Url "+ColorUrl+"'>"+((Destacados>-1)?this.Ips[i]["Destacados"][Destacados]["Url"]:"")+"</div>"+"<div class='EntradaLog_Peticiones'"+ColorPeticiones+">"+this.Ips[i]["Destacados"].length+"</div>"+"<div class='EntradaLog_TiempoInicio'>"+this.Ips[i]["Datos"][0]["Hora"]+"</div>"+"<div class='EntradaLog_TiempoFin'>"+this.Ips[i]["Datos"][this.Ips[i]["Datos"].length-1]["Hora"]+"</div>"+"<div class='EntradaLog_InfoClienteWeb "+ColorNavegador+"'>"+this.Ips[i]["Info"]["NombreCorto"]+" "+this.Ips[i]["Info"]["PlataformaCorto"]+"</div>"+"</div>"+"</div>"+"<div class='EntradaLog_Datos'>"+"</div>"+"</div>";}}
Filas+="</div>";Botones+="</div>";$("#Log_Lista").html(Botones+Filas);$(".EntradaLog_Fila").off("click").on("click",function(e){var parent=e.target;while(parent.id===""){parent=parent.parentNode;}
$Admin.Log.ExpandirIp(parent.id);});$(".Log_ListaBoton").on("change",function(e){var Id=e.target.id.slice(14);$(".Log_Lista").css({display:"none"});$("#Log_ListaP"+Id).css({display:"block"});});$("#Log_CargandoF4").css({color:"#999"});$("#Log_Cargando").attr("visible",false);$("#MarcoNavegacion").css({cursor:'auto'});$("#Log_Lista").css({display:"block"});$Base.Cargando("FALSE");};this.CrearStats=function(){this.ArrayDocumentos=[];this.ArrayErrores=[];this.ArrayImagenes=[];this.ArrayObjetos=[];for(var i=0;i<this.Ips.length;i++){for(var e=0;e<this.Ips[i]["Datos"].length;e++){switch(this.Ips[i]["Datos"][e]["Relevancia"]){case 2:this.AgregarImagen(this.Ips[i]["Datos"][e]["Url"]);break;case 5:this.AgregarDocumento(this.Ips[i]["Datos"][e]["Url"]);break;case 7:this.AgregarError(this.Ips[i]["Datos"][e]["Url"]);break;default:this.AgregarObjeto(this.Ips[i]["Datos"][e]["Url"],this.Ips[i]["Datos"][e]["Relevancia"]);break;}}}
this.ArrayDocumentos.sort(function(a,b){return(b["Contador"]-a["Contador"]);});this.ArrayErrores.sort(function(a,b){return(b["Contador"]-a["Contador"]);});this.ArrayImagenes.sort(function(a,b){return(b["Contador"]-a["Contador"]);});this.ArrayObjetos.sort(function(a,b){return(b["Contador"]-a["Contador"]);});var TotalEntradas=20;var Codigo="<div class='Log_Stat'>"+"<h2>Documentos más solicitados</h2>"+"<div class='Log_StatsMarco'>"+"<table class='Log_StatsTabla'>";for(var i=0;i<TotalEntradas;i++){if(i===this.ArrayDocumentos.length){break;}
Codigo+="<tr>"+"<td style='color:green'>"+this.ArrayDocumentos[i]["Url"]+"</td>"+"<td>"+"<span class='Log_StatBarra' style='background-color:green; width:"+(300*this.ArrayDocumentos[i]["Contador"]/this.ArrayDocumentos[0]["Contador"])+"px'>"+this.ArrayDocumentos[i]["Contador"]+"</span></td>"+"</tr>";}
Codigo+="</table></div></div>";Codigo+="<div class='Log_Stat'>"+"<h2>Documentos de Error</h2>"+"<div class='Log_StatsMarco'>"+"<table class='Log_StatsTabla'>";for(var i=0;i<TotalEntradas;i++){if(i===this.ArrayErrores.length){break;}
Codigo+="<tr>"+"<td style='color:purple'>"+this.ArrayErrores[i]["Url"]+"</td>"+"<td>"+"<span class='Log_StatBarra' style='background-color:purple; width:"+(300*this.ArrayErrores[i]["Contador"]/this.ArrayErrores[0]["Contador"])+"px'>"+this.ArrayErrores[i]["Contador"]+"</span></td>"+"</tr>";}
Codigo+="</table></div></div>";Codigo+="<div class='Log_Stat'>"+"<h2>Imagenes más solicitadas</h2>"+"<div class='Log_StatsMarco'>"+"<table class='Log_StatsTabla'>";for(var i=0;i<TotalEntradas;i++){if(i===this.ArrayImagenes.length){break;}
Codigo+="<tr>"+"<td style='color:grey'>"+this.ArrayImagenes[i]["Url"]+"</td>"+"<td>"+"<span class='Log_StatBarra' style='background-color:grey; width:"+(300*this.ArrayImagenes[i]["Contador"]/this.ArrayImagenes[0]["Contador"])+"px'>"+this.ArrayImagenes[i]["Contador"]+"</span></td>"+"</tr>";}
Codigo+="</table></div></div>";Codigo+="<div class='Log_Stat'>"+"<h2>Objetos más solicitados</h2>"+"<div class='Log_StatsMarco'>"+"<table class='Log_StatsTabla'>";for(var i=0;i<TotalEntradas;i++){if(i===this.ArrayObjetos.length){break;}
Codigo+="<tr>"+"<td class='"+this.ColorRelevancia(this.ArrayObjetos[i]["Tipo"])+"'>"+this.ArrayObjetos[i]["Url"]+"</td>"+"<td>"+"<span class='Log_StatBarra' style='width:"+(300*this.ArrayObjetos[i]["Contador"]/this.ArrayObjetos[0]["Contador"])+"px'>"+this.ArrayObjetos[i]["Contador"]+"</span></td>"+"</tr>";}
Codigo+="</table></div></div>";document.getElementById("Log_Stats").innerHTML=Codigo;$("#Log_CargandoF3").css({color:"#999"});$("#Log_CargandoF4").css({color:"#FFF"});setTimeout(function(){$Admin.Log.CrearTablaDatos();},500);};this.AgregarDocumento=function(Url){for(var i=0;i<this.ArrayDocumentos.length;i++){if(this.ArrayDocumentos[i]["Url"]===Url){this.ArrayDocumentos[i]["Contador"]++;return;}}
var Ret={"Url":Url,"Contador":1};this.ArrayDocumentos.push(Ret);};this.AgregarError=function(Url){for(var i=0;i<this.ArrayErrores.length;i++){if(this.ArrayErrores[i]["Url"]===Url){this.ArrayErrores[i]["Contador"]++;return;}}
var Ret={"Url":Url,"Contador":1};this.ArrayErrores.push(Ret);};this.AgregarImagen=function(Url){for(var i=0;i<this.ArrayImagenes.length;i++){if(this.ArrayImagenes[i]["Url"]===Url){this.ArrayImagenes[i]["Contador"]++;return;}}
var Ret={"Url":Url,"Contador":1};this.ArrayImagenes.push(Ret);};this.AgregarObjeto=function(Url,Tipo){for(var i=0;i<this.ArrayObjetos.length;i++){if(this.ArrayObjetos[i]["Url"]===Url){this.ArrayObjetos[i]["Contador"]++;return;}}
var Ret={"Url":Url,"Contador":1,"Tipo":Tipo};this.ArrayObjetos.push(Ret);};this.ExpandirIp=function(Id,MostrarTodo=false){var PosIp=Id.slice(10);if(this.Ips[PosIp]["Abierto"]===false){var Checks=this.ObtenerChecks();$("#"+Id).attr("abierto",true);var ColorNavegador="black";switch(this.Ips[PosIp]["Info"]["Tipo"]){case 0:ColorNavegador='Log_Cliente_Navegador';break;case 1:ColorNavegador='Log_Cliente_Bot';break;case 2:ColorNavegador='Log_Cliente_Desconocido';break;}
var Codigo="<h1 class='Log_Titulo1'>"+this.Ips[PosIp]["Ip"]+"</h1>"+"<table class='Log_TituloTabla'>"+"<tr>"+"<td>Sistema</td>"+"<td>:</td>"+"<td class='"+ColorNavegador+"'>"+this.Ips[PosIp]["Info"]["Plataforma"]+"</td>"+"</tr>"+"<tr>"+"<td>Navegador</td>"+"<td>:</td>"+"<td class='"+ColorNavegador+"'>"+this.Ips[PosIp]["Info"]["Nombre"]+"</td>"+"</tr>"+"<tr>"+"<td>Fecha</td>"+"<td>:</td>"+"<td>"+this.Ips[PosIp]["Fecha"]+"</td>"+"</tr>"+"<tr>"+"<td>Conectado desde</td>"+"<td>:</td>"+"<td>"+this.Ips[PosIp]["Datos"][0]["Hora"]+"</td>"+"</tr>"+"<tr>"+"<td>Conectado hasta</td>"+"<td>:</td>"+"<td>"+this.Ips[PosIp]["Datos"][this.Ips[PosIp]["Datos"].length-1]["Hora"]+"</td>"+"</tr>"+"<tr>"+"<td>User Agent</td>"+"<td>:</td>"+"<td>";for(var i=0;i<this.Ips[PosIp]["Ua"].length;i++){Codigo+="<pre class='Log_UserAgent' title='"+this.Ips[PosIp]["Ua"][i]+"'>"+this.Ips[PosIp]["Ua"][i]+"</pre>";}
Codigo+="</td>"+"</tr>"+"</table>";Codigo+="<div class='Log_TablaEntrada'>";Codigo+="<div class='Log_TablaEntradaFila' style='background-color:#222; color:#FFF !important; font-weight:bold;'>"+"<div>Hora</div>"+"<div>Tipo</div>"+"<div>Url</div>"+"<div></div>"+"<div>Salida</div>"+"<div style='color:white'>Tamaño</div>"+"</div>";for(var i=0;i<this.Ips[PosIp]["Datos"].length;i++){if(Checks[this.Ips[PosIp]["Datos"][i]["Relevancia"]]===true||MostrarTodo===true){Codigo+="<div class='Log_TablaEntradaFila' tipo='"+this.Ips[PosIp]["Datos"][i]["Relevancia"]+"'>"+"<div>"+this.Ips[PosIp]["Datos"][i]["Hora"]+"</div>"+"<div>"+this.Ips[PosIp]["Datos"][i]["Peticion"]+"</div>"+"<div class='"+this.ColorRelevancia(this.Ips[PosIp]["Datos"][i]["Relevancia"])+"'>"+this.Ips[PosIp]["Datos"][i]["Url"]+"</div>"+"<div>"+this.ParsearRespuesta(this.Ips[PosIp]["Datos"][i]["Ret"])+"</div>"+"<div>"+this.Ips[PosIp]["Datos"][i]["Ret"]+"</div>"+"<div>"+this.Ips[PosIp]["Datos"][i]["Tam"]+"</div>"+"</div>";}}
Codigo+="</div>"+"<div class='Log_ContenidoOculto'>Mostrar contenido oculto.</div>";$("#"+Id+" > .EntradaLog_Datos").html(Codigo);}
else{$("#"+Id).attr("abierto",false);$("#"+Id+" > .EntradaLog_Datos").html("");}
this.Ips[PosIp]["Abierto"]=!this.Ips[PosIp]["Abierto"];};this.TipoUrl=function(Url,Ret=0){var nUrl=Url.toLowerCase();if(nUrl.indexOf("banearip.php")!==-1){this.TotalTipos["Ataques"]++;return 9;}
if(nUrl.indexOf("?")!==-1){this.TotalTipos["Advertencias"]++;return 8;}
if(Ret==="404"){this.TotalTipos["Errores404"]++;return 7;}
if(nUrl.indexOf("error404")!==-1){this.TotalTipos["Errores404"]++;return 7;}
if(nUrl.indexOf(".zip")!==-1){this.TotalTipos["Zips"]++;return 6;}
if(nUrl.indexOf(".php")!==-1){this.TotalTipos["Documentos"]++;return 5;}
if(nUrl.indexOf(".html")!==-1){this.TotalTipos["Documentos"]++;return 5;}
if(nUrl.indexOf(".cmd")!==-1){this.TotalTipos["Documentos"]++;return 5;}
if(nUrl.indexOf(".css")!==-1){this.TotalTipos["CSS"]++;return 4;}
if(nUrl.indexOf(".js")!==-1){this.TotalTipos["JS"]++;return 3;}
if(nUrl.indexOf(".svg")!==-1){this.TotalTipos["Imagenes"]++;return 2;}
if(nUrl.indexOf(".ico")!==-1){this.TotalTipos["Imagenes"]++;return 2;}
if(nUrl.indexOf(".png")!==-1){this.TotalTipos["Imagenes"]++;return 2;}
if(nUrl.indexOf(".jpg")!==-1){this.TotalTipos["Imagenes"]++;return 2;}
if(nUrl.indexOf(".gif")!==-1){this.TotalTipos["Imagenes"]++;return 2;}
if(nUrl.indexOf(".")===-1){this.TotalTipos["Documentos"]++;return 5;}
this.TotalTipos["Otros"]++;return 1;};this.AgregarLinea=function(Linea,NumLinea){var Datos=Linea.split(" ");var TotalDatos=Datos.length;var Ret={Ip:"0.0.0.0",Datos:[{}],Ua:[""],Abierto:false,Destacados:[],Fecha:""};var Ua="";for(var i=12;i<Datos.length-1;i++){Ua+=Datos[i]+" ";}
if(TotalDatos<10){return;}
Ret["Ip"]=Datos[0];Ret["Datos"][0]["Linea"]=NumLinea;var FH=Datos[3].split(":");Ret["Fecha"]=FH[0].slice(1);Ret["Datos"][0]["Hora"]=FH[1]+":"+FH[2]+":"+FH[3];Ret["Datos"][0]["Peticion"]=Datos[5].slice(1);Ret["Datos"][0]["Url"]=Datos[6];Ret["Datos"][0]["Http"]=Datos[7].slice(0,-1);Ret["Datos"][0]["Ret"]=Datos[8];Ret["Datos"][0]["Relevancia"]=this.TipoUrl(Ret["Datos"][0]["Url"],Ret["Datos"][0]["Ret"]);Ret["Datos"][0]["Tam"]=Datos[9];Ret["Datos"][0]["Server"]=Datos[10];for(var i=0;i<this.Ips.length;i++){if(this.Ips[i]["Ip"]===Ret["Ip"]&&this.Ips[i]["Fecha"]===Ret["Fecha"]){this.Ips[i]["Datos"].push(Ret["Datos"][0]);for(var u=0;u<this.Ips[i]["Ua"].length;u++){if(this.Ips[i]["Ua"][u].toLowerCase().trim()===Ua.toLowerCase().trim()){return;}}
this.Ips[i]["Ua"].push(Ua);return;}}
Ret["Ua"][0]=Ua;this.Ips.push(Ret);};this.ObtenerNavegador2=function(UA){var Tipo=2;var Nombre="Desconocido";var NombreCorto="Desconocido";var Version="";var Plataforma="Desconocido";var PlataformaCorto="";UserAgent=UA.toLowerCase();if(UserAgent.indexOf("android")!==-1){PlataformaCorto='Android';Plataforma='Android';}
else if(UserAgent.indexOf("linux")!==-1){PlataformaCorto='Linux';Plataforma='Linux';}
else if(UserAgent.indexOf("iphone")!==-1){PlataformaCorto='iPhone';Plataforma='iPhone';}
else if(UserAgent.indexOf("ipad")!==-1){PlataformaCorto='iPad';Plataforma='iPad';}
else if(UserAgent.indexOf("macintosh")!==-1){PlataformaCorto='Mac';Plataforma='Macintosh';}
else if(UserAgent.indexOf("mac os x")!==-1){PlataformaCorto='Mac';Plataforma='Macintosh';}
else if(UserAgent.indexOf("windows nt 5.0")!==-1){PlataformaCorto='Win2k';Plataforma='Microsoft Windows 2000';}
else if(UserAgent.indexOf("windows nt 5.")!==-1){PlataformaCorto='WinXP';Plataforma='Microsoft Windows XP';}
else if(UserAgent.indexOf("windows nt 6.0")!==-1){PlataformaCorto='WinVista';Plataforma='Microsoft Windows Vista';}
else if(UserAgent.indexOf("windows nt 6.1")!==-1){PlataformaCorto='Win7';Plataforma='Microsoft Windows 7';}
else if(UserAgent.indexOf("windows nt 6.2")!==-1){PlataformaCorto='Win8';Plataforma='Microsoft Windows 8';}
else if(UserAgent.indexOf("windows nt 10.0")!==-1){PlataformaCorto='Win10';Plataforma='Microsoft Windows 10';}
else if(UserAgent.indexOf("windows 98")!==-1){PlataformaCorto='Win98';Plataforma='Microsoft Windows 98';}
else if(UserAgent.indexOf("windows")!==-1){PlataformaCorto='Win';Plataforma='Microsoft Windows';}
else if(UserAgent.indexOf("win32")!==-1){PlataformaCorto='Win';Plataforma='Microsoft Windows';}
if(UserAgent.indexOf("opera mini")!==-1){NombreCorto='Opera Mini';Nombre='Opera Mini';Tipo=0;}
else if(UserAgent.indexOf("opera")!==-1){NombreCorto='Opera';Nombre='Opera';Tipo=0;}
else if(UserAgent.indexOf("edge")!==-1){NombreCorto='Edge';Nombre='Microsoft Edge';Tipo=0;}
else if(UserAgent.indexOf("firefox")!==-1){NombreCorto='Firefox';Nombre='Mozilla Firefox';Tipo=0;}
else if(UserAgent.indexOf("chrome")!==-1){NombreCorto='Chrome';Nombre='Google Chrome';Tipo=0;}
else if(UserAgent.indexOf("ucbrowser")!==-1){NombreCorto='UCBrowser';Nombre='UCBrowser';Tipo=0;}
else if(UserAgent.indexOf("safari")!==-1){NombreCorto='Safari';Nombre='Apple Safari';Tipo=0;}
else if(UserAgent.indexOf("netscape")!==-1){NombreCorto='Netscape';Nombre='Netscape';Tipo=0;}
else if(UserAgent.indexOf("feedly")!==-1){NombreCorto='Feedly';Nombre='Feedly RSS Reader';Tipo=1;}
else if(UserAgent.indexOf("inoreader")!==-1){NombreCorto='InoReader';Nombre='InoReader Crawler';Tipo=1;}
else if(UserAgent.indexOf("feedfetcher-google")!==-1){NombreCorto='Google Reader';Nombre='Google Reader';Tipo=1;}
else if(UserAgent.indexOf("baiduspider")!==-1){NombreCorto='Baiduspider';Nombre='Baiduspider';Tipo=1;}
else if(UserAgent.indexOf("ezooms")!==-1){NombreCorto='Ezooms Bot';Nombre='Ezooms';Tipo=1;}
else if(UserAgent.indexOf("yandexbot")!==-1){NombreCorto='YandexBot';Nombre='YandexBot';Tipo=1;}
else if(UserAgent.indexOf("yandeximages")!==-1){NombreCorto='YandexImages';Nombre='YandexImages';Tipo=1;}
else if(UserAgent.indexOf("exabot")!==-1){NombreCorto='Exabot';Nombre='Exabot';Tipo=1;}
else if(UserAgent.indexOf("alexa")!==-1){NombreCorto='Alexa';Nombre='Alexa Web Crawler';Tipo=1;}
else if(UserAgent.indexOf("bingbot")!==-1){NombreCorto='Bing';Nombre='Bing Bot';Tipo=1;}
else if(UserAgent.indexOf("msnbot")!==-1){NombreCorto='MSNBot';Nombre='MSN Bot';Tipo=1;}
else if(UserAgent.indexOf("majestic")!==-1){NombreCorto='Majestic';Nombre='Majestic Bot';Tipo=1;}
else if(UserAgent.indexOf("googlebot")!==-1){NombreCorto='Googlebot';Nombre='Googlebot';Tipo=1;}
else if(UserAgent.indexOf("googlebot-mobile")!==-1){NombreCorto='Googlebot';Nombre='Googlebot Mobile';Tipo=1;}
else if(UserAgent.indexOf("facebook")!==-1){NombreCorto='FaceeBook';Nombre='FaceBook Bot';Tipo=1;}
else if(UserAgent.indexOf("ahrefsbot")!==-1){NombreCorto='AhrefsBot';Nombre='AhrefsBot';Tipo=1;}
else if(UserAgent.indexOf("google-site-verifi")!==-1){NombreCorto='Googlebot';Nombre='Google-Site-Verification';Tipo=1;}
else if(UserAgent.indexOf("bot")!==-1){NombreCorto='Bot';Nombre='Bot genérico';Tipo=2;}
else if(UserAgent.indexOf("msie 11.0")!==-1){NombreCorto='IE11';Nombre='Internet Explorer';Version=11.0;Tipo=0;}
else if(UserAgent.indexOf("msie 10.0")!==-1){NombreCorto='IE10';Nombre='Internet Explorer';Version=10.0;Tipo=0;}
else if(UserAgent.indexOf("msie 9.0")!==-1){NombreCorto='IE9';Nombre='Internet Explorer';Version=9.0;Tipo=0;}
else if(UserAgent.indexOf("msie 8.0")!==-1){NombreCorto='IE8';Nombre='Internet Explorer';Version=8.0;Tipo=0;}
else if(UserAgent.indexOf("msie 7.0")!==-1){NombreCorto='IE7';Nombre='Internet Explorer';Version=7.0;Tipo=0;}
else if(UserAgent.indexOf("msie 6.0")!==-1){NombreCorto='IE6';Nombre='Internet Explorer';Version=6.0;Tipo=0;}
else if(UserAgent.indexOf("msie")!==-1){NombreCorto='IE';Nombre='Internet Explorer';Tipo=0;}
return{"Nombre":Nombre,"NombreCorto":NombreCorto,"Version":Version,"Plataforma":Plataforma,"PlataformaCorto":PlataformaCorto,"Tipo":Tipo};};this.ClickCheckOpciones=function(){var Checks=this.ObtenerChecks();var Checks2={0:document.getElementById('ChNavegadores').checked,1:document.getElementById('ChBots').checked,2:document.getElementById('ChDesconocido').checked};for(var i=0;i<this.Ips.length;i++){var Pos=-1;for(var e=0;e<this.Ips[i]["Destacados"].length;e++){if(Checks[this.Ips[i]["Destacados"][e]["Relevancia"]]===true){Pos=e;break;}}
if(Pos>-1&&Checks2[this.Ips[i]["Info"]["Tipo"]]===true){document.getElementById("EntradaLog"+i).style.display="table";var Url=$("#EntradaLog"+i+" .EntradaLog_Url");Url.attr('class',this.ColorRelevancia(this.Ips[i]["Destacados"][Pos]["Relevancia"]));Url.html(this.Ips[i]["Destacados"][Pos]["Url"]);if(this.Ips[i]["Abierto"]===true){this.Ips[i]["Abierto"]=false;this.ExpandirIp("EntradaLog"+i);}}
else{document.getElementById("EntradaLog"+i).style.display="none";}}};};
